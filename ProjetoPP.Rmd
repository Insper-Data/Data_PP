---
title: "Projeto Insper Data - Politicas Publicas"
author: "Bruno, Bernardo e Vinicius"
date: "14/09/2020"
output:
  html_document:
    df_print: paged
    toc: yes
    toc_float:
      collapsed: yes
      smooth_scroll: yes
    number_section: yes
    theme: readable
    highlight: haddock
editor_options: 
  chunk_output_type: console
---


``` {r setup, include = FALSE}

knitr::opts_chunk$set(warning = FALSE, message = FALSE)

```

Packages 
```{r}
library(vctrs)
library(skimr)
library(rvest)
library(ggrepel)
library(av)
library(RColorBrewer)
library(tidyverse)
library(broom)
library(gganimate)
library(janitor)
library(stringi)
library(lubridate)
library(readxl)
library(sf)
library(ggthemes)
library(spData)
library(estimatr)
library(binsreg)
```

#Introduction

## Oxford Covid-19 Government Response Tracker

	The Oxford COVID-19 Government Response Tracker (OxCGRT) consists of a database that collects information regarding several different commonly used policies that governments around the world have taken to respond to the pandemic itself. In our study, the data taken from the 18 indicators will be used as an indication of the decisions that each government made, regarding containment and health, economic support and stringency; valuable information as we intend to comprehend how the decision regarding each of the points just mentioned is related to the institucional characteristics of each country; and how they have influenced on the evolution of the pandemic respectively. 
The OxCGRT is especially relevant as it proposes standardized indicators of policies, which makes possible the comparison between countries. It is important, however, to make clear that the response tracker does not point out the effectiveness or the appropriateness of each policy and country’s response - which will be indirectly analyzed in our study. 

The specific policy and response categories are coded as follows:

School closures:
0 - No measures
1 - recommend closing
2 - Require closing (only some levels or categories,
eg just high school, or just public schools)
3 - Require closing all levels
No data - blank

Workplace closures:
0 - No measures
1 - recommend closing (or work from home)
2 - require closing (or work from home) for some
sectors or categories of workers
3 - require closing (or work from home) all but essential workplaces (eg grocery stores, doctors)
No data - blank

Cancel public events:
0- No measures
1 - Recommend cancelling
2 - Require cancelling
No data - blank

Restrictions on gatherings:
0 - No restrictions
1 - Restrictions on very large gatherings (the limit is above 1000 people)
2 - Restrictions on gatherings between 100-1000 people
3 - Restrictions on gatherings between 10-100 people
4 - Restrictions on gatherings of less than 10 people
No data - blank

Close public transport:
0 - No measures
1 - Recommend closing (or significantly reduce volume/route/means of transport available)
2 - Require closing (or prohibit most citizens from using it)

Public information campaigns:
0 -No COVID-19 public information campaign
1 - public officials urging caution about COVID-19
2 - coordinated public information campaign (e.g. across traditional and social media)
No data - blank

Stay at home:
0 - No measures
1 - recommend not leaving house
2 - require not leaving house with exceptions for daily exercise, grocery shopping, and ‘essential’ trips
3 - Require not leaving house with minimal exceptions (e.g. allowed to leave only once every few days, or only one person can leave at a time, etc.)
No data - blank

Restrictions on internal movement:
0 - No measures
1 - Recommend movement restriction
2 - Restrict movement

International travel controls:
0 - No measures
1 - Screening
2 - Quarantine arrivals from high-risk regions
3 - Ban on high-risk regions
4 - Total border closure
No data - blank

Testing policy
0 – No testing policy
1 – Only those who both (a) have symptoms AND (b) meet specific criteria (eg key workers, admitted to hospital, came into contact with a known case, returned from overseas)
2 – testing of anyone showing COVID-19 symptoms
3 – open public testing (eg “drive through” testing available to asymptomatic people)
No data

Contract tracing
0 - No contact tracing
1 - Limited contact tracing - not done for all cases
2 - Comprehensive contact tracing - done for all cases
No data

Face coverings
0- No policy
1- Recommended
2- Required in some specified shared/public spaces outside the home with other people present, or some situations when social distancing not possible
3- Required in all shared/public spaces outside the home with other people present or all situations when social distancing not possible
4- Required outside the home at all times regardless of location or presence of other people

https://www.bsg.ox.ac.uk/research/research-projects/oxford-covid-19-government-response-tracker


## World Justice Project Rule of Law Index
	
	The World Justice Project Rule of Law Index, available in the following link: https://worldjusticeproject.org/our-work/research-and-data/wjp-rule-law-index-2020/current-historical-data; consists in a quantitative assessment tool designed by the WJP that offers a very interesting picture as far as the legal institutions of country go, analysing the political environment, legal restrictions to governments powers, corruption incidence, order and security, civil and criminal justice, regulatory enforcement and the access to fundamental rights. Collected since 2012, the WJP Rule of Law Index is based on a worldwide survey, which covers 128 countries and jurisdictions, through household and expert inquiries. The database also groups countries according to their income level.
	We’ve chosen the WJP Rule of Law Index, as opposed to the World Bank Doing Business index, as there have been indications of improper manipulation of data regarding such database. However, the information brought by such bibliography would be a valuable compliment to the WJP database, as the World Bank encompasses a perspective less associated with legal institutions, and strictly related to economic ones. Because of that, we’d like to point out that if the World Bank formally announces that the data from the Doing Business index has been revised and is fully reliable, it would be interesting to unify such information in our database, providing even more robustness to our econometric analysis and more possibilities of study derived from our database.
	
## Our World in Data (Covid-19)

	Our World in Data is a research and data hub that is recognized around the world, with information that goes from demographic change to sustainability and politics. In this study, however, we’ve focused on the data that the site provides regarding the Covid-19 pandemic, updated daily. The database provides information regarding deaths, cases, tests, hospitalizations, mortality risk and excess mortality - as well as population numbers, for example. As a reliable source, used in researches around the world, the Our World in Data Covid-19 Data has been selected as our reference of the pandemic development around the globe, being of unequivocal relevance in our study. 
  It is worth pointing out that, in the intent to make data from different countries more comparable, we’ve created two variables through such database. Firstly, we’ve defined a relative measure of contamination: cases per million individuals in the population; which can encompass a richer information regarding the differences in the development of the pandemic in each country, as opposed to the absolute measures. Based on such information, we’ve created a variable that counts the days passed since the country reached the mark of 1 case per million inhabitants - a valuable material that amplifies our comparison capabilities and provides a more interesting control variable to our study, as countries can be positioned in different moments of Covid-19’s propagation.

## The Economist’s 2019 Democracy Index

	The 2019 Democracy Index, measured by The Economist’s Intelligence Unit, consists in a picture of the political context in 165 independent states and 2 territories, in the year of 2019. The index is based on a continuous grade between 0 and 10, given to each country, that goes from Authoritarian Regime (a 0) to Full Democracy (a 10), based on on 60 indicators divided between 5 categories: electoral process and pluralism; civil liberties; the functioning of the government; political participation; and political culture. Because of that, it is a powerful measure for political institutions, that complements well the WJP Rule of Law Index.
	It is important to make explicit a supposition that we make when using the 2019 Democracy Index: the political matrix of each country tends to present only marginal changes, from one year to the next; and because of that we believe it is reasonable to assume that the indicators that make part of the Democracy Index haven’t changed significantly from 2019 to 2020. However, it would be desirable that this database is updated as soon as the 2020 Democracy Index is made available by The Economist’s Intelligence Unit. More than that, it would be interesting to study the possible impacts of the Covid-19’s pandemic in the political institutional matrix of the countries that compose such database.
	
## Gini Index
	
	The Gini Index is a well-known measure of economic inequality, measuring income distribution across a country’s population, according to public data of the respective economy. In our study, we have obtained the latest result of the Gini index to each country that is contained in our database - a decision which supposes that such information holds up even to countries whose index dates from 2 decades ago. Even so, the decision to use the Gini Index in our study is based on the necessity to control our analysis with the economic inequality of each country, as studies around the world have shown that the economic and distributional gap has an impact in the development of the pandemic. In relation to that, a group within Insper Data, composed by the students Arthur Alberti, Gustavo Luchesi and Pedro Henrique Saboia; has developed a study that shows the impact of the different levels of income and infectivity in the excess mortality associated with Covid-19, in all microrregions of Brazil - if you have any interest in such study, be sure to take a look at https://github.com/Insper-Data/Data-Micro. 
Nevertheless, the Gini Index, even with lags in some countries, can be considered the most complete and robust data encompassing income inequality, enabling us to control our study with such information. In addition to that, it provides us with a powerful analytical tool, that could be used as the focus of a study, through our database.

## Our Database

	By aggregating all the information previously detailed, our database consists in a hub of institucional, political and Covid-19 pandemic’s statistics, which makes feasible an analysis that intends to relate the development of such data. To ease the manipulation of different databases and enable further manipulation, we have developed a simple dictionary, which states the name of each country in each database, and associates it with the respective Iso-Code of the nation. In our study, the use of the file will be guided to develop research on the relationship between the institutional environment of different countries and the efficiency of measures to contain the pandemic, in regards to public policies. However, we believe that there are multiple ways to take on such data and make much valuable analysis and interpretations - ones that could even reinforce the relevance of political and institucional matrices.
	This document is divided in three sections, essentially: the manipulation and unification of databases; the descriptive analysis of the data; and the regression and robustness analysis. In the end of the document, we also provide everyone interested in such study some important empirical and theoretical bibliographical references, which we’ve used to develop our study, and that can be valuable to anyone interested in using this database as a study and/or research material.


## Getting the databases
```{r}

setwd("C:/Users/User/Desktop/dataset/Data_PP/bases")

covid <- read_csv("https://covid.ourworldindata.org/data/owid-covid-data.csv") %>% 
  filter(!location %in% c("International", "World","Kosovo"),
         date > "2019-12-31") %>% 
  select(-stringency_index)

tests <- read_csv("https://raw.githubusercontent.com/owid/covid-19-data/master/public/data/testing/covid-testing-all-observations.csv")

CRT <- read_csv("https://raw.githubusercontent.com/OxCGRT/covid-policy-tracker/master/data/OxCGRT_latest.csv")

wjp_2019 <- read_excel("FINAL_2020_wjp_rule_of_law_index_HISTORICAL.xlsx", 
                        sheet = "WJP ROL Index 2019 Scores") 

democracy <- read_excel("EIU-Democracy Indices - Dataset - v3.xlsx", 
    sheet = "input-data-from-EIU-recentyrs", skip = 176)

colnames(democracy)[1] <- "location"

giniOWID <- read_csv("economic-inequality-gini-index.csv")

iso_codes <- read_csv("https://raw.githubusercontent.com/lukes/ISO-3166-Countries-with-Regional-Codes/master/all/all.csv") %>% 
   transmute(code = as.numeric(`country-code`),
             name,
             iso_code = `alpha-3`,
             region,
             iso2 = `alpha-2`) %>% 
  clean_names()

```




## Cleaning the data
```{r}
# Cleaning the test database from Our World in Data
t <- tests %>% 
  select("Entity":"Date", "Daily change in cumulative total":"Short-term positive rate") %>% 
  separate(Entity, c("country", "escala"), sep = " - ") %>% 
  rename(date = "Date", iso_code = "ISO code") 


t %>% count(escala)

df1 <- t %>% 
    filter(country %in% c("Singapore", "Poland", "Italy", "India", "France") & escala !=  "people tested")

df2 <- t %>%
    filter(country %in% c("United States", "Japan") & escala == "tests performed")
  
t <- t %>% 
    anti_join(df1) %>% 
    anti_join(df2)

# Arranging iso to join in the DMI

iso <- iso_codes %>% 
  mutate(across(where(is.character), ~ str_remove_all(.x, "(?<=United Kingdom).+")),
         across(where(is.character), ~ str_replace_all(.x, "Korea, Republic of", "South Korea")),
         across(where(is.character), ~ str_replace_all(.x, "Czechia", "Czech Republic")),
         across(where(is.character), ~ str_replace_all(.x, "Kyrgyzstan", "Kyrgyz Republic")),
         across(where(is.character), ~ str_remove_all(.x, "(?<=Russia).+")),
         across(where(is.character), ~ str_replace_all(.x, "Lao People's Democratic Republic", "Laos")),
         across(where(is.character), ~ str_remove_all(.x, "(?<=Syria).+")),
         across(where(is.character), ~ str_replace_all(.x, "Congo, Democratic Republic of the", "Democratic Republic of Congo")),
         across(where(is.character), ~ str_replace_all(.x, "Bosnia and Herzegovina", "Bosnia and Hercegovina")),
         across(where(is.character), ~ str_replace_all(.x, "Côte d'Ivoire", "Côte d’Ivoire")),
         across(where(is.character), ~ str_replace_all(.x, "Viet Nam", "Vietnam")),
         across(where(is.character), ~ str_replace_all(.x, "Eswatini", "eSwatini")),
         across(where(is.character), ~ str_replace_all(.x, "Korea \\(Democratic People's Republic of\\)", "North Korea")),
         across(where(is.character), ~ str_remove_all(.x, "(?<=.)\\s\\(.+")),
         across(where(is.character), ~ str_remove_all(.x, "(?<=.)\\,\\s.+")),
         across(where(is.character), ~ str_replace_all(.x, "(?<!.)Congo(?!,)", "Congo (Brazzaville)")))

# Checking if the changes are correct

democracy %>% 
        filter(!is.na(location)) %>% 
        mutate(`Electoral process and pluralism` = as.double(`Electoral process and pluralism`),
               Rank = str_remove(Rank, "[=]$")) %>% 
        anti_join(iso, by = c("location" = "name"))

# Cleaning DMI 

dmi <- democracy %>% 
        filter(!is.na(location)) %>% 
        mutate(`Electoral process and pluralism` = as.double(`Electoral process and pluralism`), 
               Rank = str_remove(Rank, "[=]$")) %>% 
        left_join(iso, by = c("location" = "name")) %>% 
        mutate(location = str_remove(location, "of America"),
               Rank = as.integer(Rank),
               type = case_when(
                      Rank <= 22 ~ "Full democracy",
                      Rank >= 23 & Rank <= 75 ~ "Flawed democracy",
                      Rank >= 77 & Rank <= 113 ~ "Hybrid regime",
                      Rank >= 114 ~ "Authoritarian regime"))

# Cleaning the World Justice Project database (Institutions)

wjptidy <- wjp_2019 %>% 
  pivot_longer(-Country, names_to = "Countries", values_to = "Countries Codes") %>%
  pivot_wider(id_cols = c("Countries", "Countries Codes"), 
              names_from = "Country", values_from = "Countries Codes") %>% 
  select(-6) %>% 
  rename(iso_code = "Country Code", country_name = "Countries") %>% 
  mutate(across(`WJP Rule of Law Index: Overall Score`:`8.7. Due process of the law and rights of the accused`, ~ as.numeric(.x)))

# Cleaning the Oxford Covid-19 Response Tracker

counter = round(as.numeric(difftime(Sys.Date(), "2020-09-13", units = "days"))) 

# This line of code generates a counter which make it viable to restore data related to the US and UK 

days = (1: (257 + counter))
cpt <- CRT %>% 
  clean_names() %>% 
  mutate(date = ymd(date)) %>% 
  rename(iso_code = "country_code") %>% 
  select(- c(region_name, region_code)) %>% 
  relocate(confirmed_cases, .after = country_name) %>% 
  filter(iso_code != "RKS", jurisdiction == "NAT_TOTAL") 

# We opted to desconsider Kosovo, as the country didn't have any information in any of the other databases. Still, we believe that such decision won't change our conclusions in any significant way.
  
us <- cpt %>% 
  filter(country_name == "United States") %>% 
  slice(days)

uk <- cpt %>% 
  filter(country_name == "United Kingdom") %>% 
  slice(days)

cpt <- cpt %>% 
  filter(country_name != "United States" & iso_code != "USA",
         country_name != "United Kingdom" & iso_code != "GBR") %>% 
  bind_rows(us) %>% 
  bind_rows(uk) 

# Cleaning the Gini Index Database

giniOWIDlatest <- giniOWID %>% 
  group_by(Entity) %>% 
  filter(Year == max(Year)) %>% 
  rename(YearGINdata = Year,
         "iso_code" = "Code") %>%
  clean_names()
```


# Creating a dictionary for our database
```{r}
x <- cpt %>% 
  select(country_name, iso_code) %>% 
  unique()
  
###
y <- wjptidy %>% 
  select(country_name, iso_code)

x %>% anti_join(y, by = "iso_code") 

###
z <- covid %>% 
  select(location, iso_code) %>% 
  unique() %>% 
  clean_names()

z %>% anti_join(y, by = "iso_code") 

###
w <- t %>% 
  select(country, iso_code) %>% 
  unique()

###
y %>% anti_join(w, by = "iso_code") 

v <- giniOWIDlatest %>% 
  select(entity, iso_code)

v %>% anti_join(w, by = "iso_code") 

###
u <- dmi %>% 
  select(location, iso_code)

u %>% anti_join(w, by = "iso_code") 

#### Making the dictionary ####

dici <- iso_codes %>% 
        left_join(z, by = "iso_code") %>% 
        left_join(x, by = "iso_code") %>%
        left_join(u, by = "iso_code") %>%
        left_join(v, by = "iso_code") %>%
        left_join(y, by = "iso_code") %>%
        left_join(w, by = "iso_code") %>% 
        rename("names_covid" = "location.x",
               "names_cpt" = "country_name.x",
               "names_dmi" = "location.y",
               "names_gini" = "entity",
               "names_wjp" = "country_name.y",
               "names_tests" = "country")

###

covid <- dici %>% 
  select(name:names_covid) %>% 
  right_join(covid, by = "iso_code") %>% 
  select(-continent, -location)

wjptidy <- dici %>% 
  select(name:iso2, names_wjp) %>% 
  right_join(wjptidy, by = "iso_code") %>% 
  select(-country_name)

cpt <- dici %>% 
  select(name:iso2, names_cpt) %>% 
  right_join(cpt, by = "iso_code") %>% 
  select(-country_name)

t <- dici %>% 
  select(name:iso2, names_tests) %>% 
  right_join(t, by = "iso_code") %>% 
  select(-country)

giniOWIDlatest <- dici %>% 
  select(name:iso2, names_gini) %>% 
  right_join(giniOWIDlatest, by = "iso_code") %>% 
  select(-entity)

dmi <- dici %>% 
  select(name:iso_code) %>% 
  right_join(dmi, by = "iso_code")

```


## Structuring a unified database (Our database)
```{r}
# Unifing the World Justice Project Rule of Law with CPT

wjp_cpt <- left_join(cpt, wjptidy, by = c("iso_code", "name", "region", "iso2"))

# wjp_cpt %>% filter(is.na(name)) %>% view #### Kosovo does not appear in any database, other than CPT

# Unifing Our world in Data (Covid) + Our world in data (t) +  Democracy Index (dmi)

together <- covid %>% 
  left_join(dmi, by = c("iso_code", "region", "iso2", "name")) %>% 
  left_join(t, by = c("iso_code", "region", "iso2", "date", "name"))

# together %>% filter(is.na(name)) %>% view ### Taking Kosovo out 

# Getting all data together

base_semi <- left_join(together, wjp_cpt, by = c("iso_code", "region", "iso2", "date", "name"))

base_semi %>% count(name) 

## anti_join(together, wjp_cpt,  by = c("iso_code", "region", "iso2", "date", "name")) %>% view #### Excluding the 31/12/2019 from the database

# Unifing the Gini Index with the structured database

base_inter <- left_join(base_semi, giniOWIDlatest, by = c("iso_code", "region", "iso2", "name")) %>% 
  select(!(m1_wildcard))
```




Creating a variable that counts how many days have passed since each country has reached 1 case per million inhabitants (It is important to comment that we've used the same threshold as Our World in Data)
```{r}
marcador <- base_inter %>%
  filter(total_cases_per_million >= 1) %>% 
  group_by(name) %>% 
  mutate(rank = min_rank(total_cases_per_million),
         days_after_1pm = rank(rank, ties.method = "first")) %>% 
  relocate(days_after_1pm, .after = date) %>% 
  ungroup()

base <- left_join(base_inter, marcador) %>% 
  relocate(c(days_after_1pm, total_cases_per_million), .after = date)

rm(base_semi, base_inter, marcador, u, v, w, x, y, z, wjp_2019, giniOWID, iso, df1, df2, CRT, democracy)
```


Descriptive Analysis - Democracy Index

```{r}
dmi %>%
  ggplot(aes(x = reorder(name, -`Overall Score`), `Overall Score`, fill = type)) + 
  geom_col() +
  coord_flip() +
  theme_clean()

dmi %>%
  filter(`Overall Score` > 6) %>% 
  ggplot(aes(x = reorder(name, -`Overall Score`), `Overall Score`, fill = type)) + 
  geom_col() +
  coord_flip() +
  theme_clean()

dmi %>%
  filter(`Overall Score` < 6) %>% 
  ggplot(aes(x = reorder(name, -`Overall Score`), `Overall Score`, fill = type)) + 
  geom_col() +
  coord_flip() +
  theme_clean()

# Barplot in a circle

empty_bar <- 4
to_add <- data.frame(matrix(NA, empty_bar*nlevels(dmi$type), ncol(dmi)) )
colnames(to_add) <- colnames(dmi)
to_add$group <- rep(levels(dmi$type), each=empty_bar)
dmi <- rbind(dmi, to_add)
dmi <- dmi %>% arrange(desc(`Overall Score`), type)
dmi$id <- seq(1, nrow(dmi))
 
label_data <- dmi
number_of_bar <- nrow(label_data)
angle <- 90 - 360 * (label_data$id-0.5) /number_of_bar     
label_data$hjust <- ifelse(angle < -90, 1, 0)
label_data$angle <- ifelse(angle < -90, angle + 180, angle)
 
p <- ggplot(dmi, aes(x=as.factor(id), y=`Overall Score`, fill = type)) +    
  geom_bar(stat = "identity", alpha=0.5) +
  ylim(-50, 13) +
  theme_minimal() +
  theme(
    axis.text = element_blank(),
    axis.title = element_blank(),
    panel.grid = element_blank(),
    plot.margin = unit(rep(-2,4), "cm")) +
  coord_polar() + 
  geom_text(data = label_data, aes(x = id, y = `Overall Score` + 1, label = iso_code, hjust = hjust), color = "black", fontface = "bold",alpha=0.6,
            size = 2.5, angle = label_data$angle, inherit.aes = FALSE ) +
  labs(title = "Democracy Index")
 
p

# Map - Overall Score

base %>% 
  select(name, iso_code, iso2, `Overall Score`, date) %>% 
  filter(!is.na(`Overall Score`), date == Sys.Date() - 1) %>%
  clean_names() %>%  
  #left_join(iso) %>% 
  left_join(world, by = c("iso2" = "iso_a2")) %>% 
  ggplot() +
   geom_sf(aes(geometry = geom), data = world, fill = "lightgrey") +
   geom_sf(aes(geometry = geom, fill = overall_score)) +
   scale_fill_gradient(low = "#ff726f", high = "#0087C0", limits = c(1, 10), breaks = seq(1, 10, 1)) +
   labs(title = "Overall Score in the Democracy Index",
        subtitle = ("Values for 2019"),
        fill = "Index",
        caption = "Source: Democracy Index, The Economist") +
   theme_map() +
    theme(panel.background = element_rect(fill = "#b3d5e0"),
            legend.position = "right")

# Map - Democracy Types

base %>% 
  select(name, iso_code, type, date, `Overall Score`, iso2) %>% 
  filter(!is.na(type), date == Sys.Date() - 1) %>%
  clean_names() %>%  
  left_join(world, by = c("iso2" = "iso_a2")) %>% 
  ggplot() +
   geom_sf(aes(geometry = geom), data = world, fill = "lightgrey") +
   geom_sf(aes(geometry = geom, fill = type.x)) +
   labs(title = "Types of Democracy",
        subtitle = ("Democracy Index 2019"),
        fill = "",
        caption = "Source: Democracy Index, The Economist") +
   theme_map() +
    theme(panel.background = element_rect(fill = "#b3d5e0"),
          legend.position = "right")

```


Descriptive Analysis - Oxford Covid-19 Government Response Tracker

```{r}
# Analysis of the "flag" variables, which indicate if the public politics related to Covid have been specific to regions and counties or general to the entire country.

cpt %>%
  select(name, c1_flag,  c2_flag, c3_flag, c4_flag, 
         c5_flag, c6_flag, c7_flag, e1_flag, h1_flag, 
         h6_flag, iso_code, iso2) %>% 
  clean_names() %>% 
  group_by(name) %>% 
  mutate(generalismo = mean(c(c1_flag, c2_flag, c3_flag, 
                              c4_flag, c5_flag, c6_flag, 
                              c7_flag, e1_flag, h1_flag, h6_flag), na.rm = TRUE), 
         generalismo = mean(generalismo, na.rm = TRUE)) %>% 
  ungroup() %>% 
  left_join(world, by = c("iso2" = "iso_a2")) %>%
  ggplot() +
   geom_sf(aes(geometry = geom), data = world, fill = "lightgrey") +
   geom_sf(aes(geometry = geom, fill = generalismo)) +
   scale_fill_gradient(low = "chartreuse1", high = "coral") +
   labs(title = "Level of Political Generalism (Geographic Scope)",
        subtitle = ("Related to Pandemic Policies"),
        fill = "1 = Completely General Policies",
        caption = "Source: Oxford Covid-19 Government Policy Tracker") +
   theme_map() +
    theme(panel.background = element_rect(fill = "#b3d5d0"),
          legend.position = "right")



# Analysis of C8 (International Travel Controls)

base %>%
  select(name, c8_international_travel_controls, date, iso_code, iso2) %>%
  filter(!is.na(c8_international_travel_controls), date == Sys.Date() - 30) %>%
  clean_names() %>%
  left_join(world, by = c("iso2" = "iso_a2")) %>%
  ggplot() +
   geom_sf(aes(geometry = geom), data = world, fill = "lightgrey") +
   geom_sf(aes(geometry = geom, fill = c8_international_travel_controls)) +
  scale_fill_gradient(low = "seagreen1", 
                      high = "deeppink3", 
                      limits = c(1, 4), 
                      breaks = seq(1, 4, 1)) +
   labs(title = "International Travel Controls",
        subtitle = ("In the beggining of September"),
        fill = "Index",
        caption = "Source: Oxford Policy Tracker") +
   theme_map() +
    theme(panel.background = element_rect(fill = "#b3d5e0"),
          legend.position = "right")

# Visual analysis of the correlation between C5 e E1

cpt %>%
  select(name, c5_close_public_transport, e1_income_support) %>%
  filter(!is.na(c5_close_public_transport), !is.na(e1_income_support)) %>%
  group_by(name) %>%
  summarise(media_fechamento_transporte = mean(c5_close_public_transport),
            media_suportederenda = mean(e1_income_support)) %>%
  ggplot(mapping = aes(x = media_fechamento_transporte, y = media_suportederenda)) +
    geom_point() +
    geom_smooth(method = lm, se = FALSE) +
  labs(title = "Scatterplot: C5 and E1")

# Visual analysis of the correlation between E4 e C8

base %>%
  select(name, e4_international_support, c8_international_travel_controls, type) %>%
  filter(!is.na(e4_international_support),
         !is.na(c8_international_travel_controls)) %>%
  group_by(name) %>%
  summarise(media_log_suporte = log(mean(e4_international_support)),
            media_controle = mean(c8_international_travel_controls),
            tipe = type) %>%
  filter(media_log_suporte > 0, !is.na(tipe)) %>%
  ggplot(mapping = aes(x = media_controle, y = media_log_suporte, color = tipe)) +
    geom_point() +
    geom_smooth(method = lm, se = FALSE) +
    theme_clean() +
   labs(title = "Scatterplot: E4 and C8",
        x = "Average international travel controls",
        y = "Log average of international support")


```


# Tests

```{r}
#Experimental area

#Testes x Covid

testcovid <- base %>% 
  select(name, iso_code, `Cumulative total per thousand`, total_cases_per_million, days_after_1pm, `Income Group`) %>% 
  filter(!is.na(total_cases_per_million), 
         !is.na(`Cumulative total per thousand`), !is.na(`Income Group`), !is.na(days_after_1pm)) %>% 
  # filter(days_after_1pm == 200) %>% 
  mutate(logcasepthous = log(total_cases_per_million*1000),
         logct = log(`Cumulative total per thousand`)) %>% 
  ggplot(y = logct, x = logcasepthous) +
  geom_point(aes(y = logct, x = logcasepthous, color = `Income Group`)) +
  geom_smooth(aes(y = logct, x = logcasepthous), method = lm, se = FALSE) +
  theme_clean() +
  scale_alpha(guide = 'none') 
  labs(title = "Log(Cumulative testing per thousand) and log(Total cases per thousand)")

anim_testcovid <- testcovid + transition_time(days_after_1pm) +
  labs(title = "Days after 1 death per million: {frame_time}") +
  ease_aes('linear')

animate(anim_testcovid, renderer = gifski_renderer("giftestcovid.gif"))

####

base %>% 
  filter(days_after_1pm > 300) %>% 
  count(name)

#Mean testing by continent as time goes by
base %>% 
  select(name, iso_code, region, `Daily change in cumulative total`, days_after_1pm) %>% 
  filter(!is.na(`Daily change in cumulative total`)) %>% 
  group_by(region, days_after_1pm) %>% 
  summarise(meantest = mean(`Daily change in cumulative total`, is.na = TRUE), days_after_1pm) %>% 
  mutate(logmeantest = log(meantest)) %>% 
  ungroup() %>% 
  ggplot(x = days_after_1pm, y = logmeantest) +
  geom_path(aes(x = days_after_1pm, y = logmeantest, color = region)) +
  theme_clean() +
  labs(title = "Days after 1 case per million and daily change in cumulative testing per thousand", subtitle = "By Continents")

#Mean testing by types of democracy as time goes by
base %>% 
  select(name, iso_code, type, `Daily change in cumulative total`, days_after_1pm) %>% 
  filter(!is.na(`Daily change in cumulative total`),
         !is.na(type)) %>% 
  group_by(type, days_after_1pm) %>% 
  summarise(meantest = mean(`Daily change in cumulative total`, is.na = TRUE), days_after_1pm) %>% 
  mutate(logmeantest = log(meantest)) %>% 
  ungroup() %>% 
  ggplot(x = days_after_1pm, y = logmeantest) +
  geom_path(aes(x = days_after_1pm, y = logmeantest, color = type)) +
  theme_clean() +
  labs(title = "Days after 1 case per million and daily change in cumulative testing per thousand", subtitle = "By Types of Democracy")




```


# Descriptive Analysis of the World Justice Project Rule of Law 2019 database


1) Grouping countries according to their income group and analyze, in general, the average score of the WJP Index, aiming to obtain some relation between the product level and the local institutional strength
```{r}

# Table
wjp_income <- wjptidy %>% 
  group_by(`Income Group`) %>% 
  summarize(`WJP Rule of Law Index: Overall Score` = mean(`WJP Rule of Law Index: Overall Score`)) %>% 
  arrange(`WJP Rule of Law Index: Overall Score`) %>% 
  view()

# Column Graph
wjp_income %>%                          
  arrange(`WJP Rule of Law Index: Overall Score`) %>%                                
  mutate(`Income Group` = factor(`Income Group`, `Income Group`)) %>%   
  ggplot(aes(x=`Income Group`, y=`WJP Rule of Law Index: Overall Score`)) +                 
  geom_bar(aes(fill =`Income Group`), stat="identity") +
  scale_fill_brewer(palette = "RdYlGn") +
  theme_classic() +
  ggtitle("Income and WJP Overall Score")

```



2) Grouping countries according to the region and analyze, in general, the average score of the WJP Index, aiming to obtain some relation between the local institutional strength and the regions of the map
```{r}

wjp_region <- wjptidy %>% 
  group_by(Region) %>% 
  summarize(`WJP Rule of Law Index: Overall Score` = mean(`WJP Rule of Law Index: Overall Score`))

wjp_region %>%                          
  arrange(`WJP Rule of Law Index: Overall Score`) %>%                                
  mutate(Region = factor(Region, Region)) %>%   
  ggplot(aes(x=Region, y=`WJP Rule of Law Index: Overall Score`)) +                 
  geom_bar(aes(fill =Region), stat="identity") +
  scale_fill_brewer(palette = "Set1") +
  theme(axis.text.x=element_blank(), axis.ticks.x=element_blank()) +
  ggtitle("Region and WJP Overall Score")

```

3) Map with the WJP Overall Score

```{r}

base %>% 
  select(name, iso_code, iso2, `WJP Rule of Law Index: Overall Score`, date) %>% 
  mutate(`WJP Rule of Law Index: Overall Score` = 10*`WJP Rule of Law Index: Overall Score`) %>% 
  filter(!is.na(`WJP Rule of Law Index: Overall Score`), date == Sys.Date() - 1) %>%
  clean_names() %>% 
  #left_join(iso) %>% 
  left_join(world, by = c("iso2" = "iso_a2")) %>% 
  ggplot() +
   geom_sf(aes(geometry = geom), data = world, fill = "lightgrey") +
   geom_sf(aes(geometry = geom, fill = wjp_rule_of_law_index_overall_score)) +
   scale_fill_gradient(low = "#ff726f", high = "#0087C0", limits = c(1, 10), breaks = seq(1, 10, 1)) +
   labs(title = "WJP Rule of Law Index: Overall Score",
        subtitle = ("Values for 2019"),
        fill = "Index",
        caption = "Source: World Justice Project") +
   theme_map() +
    theme(panel.background = element_rect(fill = "#b3d5e0"),
            legend.position = "right")

```



4) Studying the relationship between the average of Factor 1 (Constraints on Government Powers) and the average of Factor 6 (Regulatory Enforcement)
```{r}

base %>% 
  select(name, type, iso_code, `Factor 1: Constraints on Government Powers`, `Factor 6: Regulatory Enforcement`) %>%
  mutate(type = factor(type, levels = c("Authoritarian regime", "Hybrid regime","Flawed democracy", "Full democracy"))) %>% 
  filter(!is.na(type)) %>% 
  ggplot(mapping = aes(x = `Factor 6: Regulatory Enforcement`, y = `Factor 1: Constraints on Government Powers`)) +
  geom_point(mapping = aes(color = type), size = 3) +
  geom_smooth(method = lm, se = FALSE) +
  geom_label_repel(data = subset(wjptidy,`Factor 6: Regulatory Enforcement` > 0.8),
                   aes(label = name),
                   box.padding   = 0.35, 
                   point.padding = 0.5,
                   segment.color = 'grey50') +
  theme_clean() +
  ggtitle("Regulatory Enforcement and Constrantis on Government Powers  -  WJP")

```

5) Map with the average value of the Factor 6 variable

```{r}

mapfactor6 <- base %>% 
  select(name, iso_code, iso2, `Factor 6: Regulatory Enforcement`, days_after_1pm) %>% 
  mutate(`Factor 6: Regulatory Enforcement` = 10*`Factor 6: Regulatory Enforcement`) %>% 
  filter(!is.na(`Factor 6: Regulatory Enforcement`), days_after_1pm == 10) %>%
  #filter(!is.na(`Factor 6: Regulatory Enforcement`), date == Sys.Date() - 1) %>%
  clean_names() %>%
  #left_join(iso) %>% 
  left_join(world, by = c("iso2" = "iso_a2")) %>% 
  ggplot() +
   geom_sf(aes(geometry = geom), data = world, fill = "lightgrey") +
   geom_sf(aes(geometry = geom, fill = factor_6_regulatory_enforcement)) +
   scale_fill_gradient(low = "#ff726f", high = "#0087C0", limits = c(1, 10), breaks = seq(1, 10, 1)) +
   labs(title = "Regulatory Enforcement - WJP",
        subtitle = ("Values for 2019"),
        fill = "Index",
        caption = "Source: World Justice Project") +
   theme_map() +
    theme(panel.background = element_rect(fill = "#b3d5e0"),
            legend.position = "right") 

mapfactor6

```


6) Studying the relationship between the averages of Factor 2 (Absence of Corruption) and variable 7.3 (Civil Justice is free of discrimination)
```{r}

wjptidy %>% 
  select(name, iso_code, `7.3 Civil justice is free of corruption`, `Factor 2: Absence of Corruption`) %>% 
  ggplot(mapping = aes(x = `7.3 Civil justice is free of corruption`, Factor, y = `Factor 2: Absence of Corruption`)) +
  geom_point() +
  geom_smooth(se = FALSE) +
  geom_label_repel(data = subset(wjptidy,`7.3 Civil justice is free of corruption`>0.9),
                   aes(label = name),
                   box.padding   = 0.35, 
                   point.padding = 0.5,
                   segment.color = 'grey50') +
  theme_classic() +
  ggtitle("Civil Justice is free of discrimination and Absence of Corruption - WJP")

```



7) Studying the relationship between the averages of Factor 5 (Order and Security) and Factor 6 (Regulatory Enforcement)
```{r}

wjptidy %>% 
  select(name, iso_code, `Factor 5: Order and Security`, `Factor 6: Regulatory Enforcement`) %>% 
  ggplot(mapping = aes(x = `Factor 6: Regulatory Enforcement`, y = `Factor 5: Order and Security`)) +
  geom_point() +
  geom_smooth(method = lm, se = FALSE) +
  geom_label_repel(data = subset(wjptidy,`Factor 6: Regulatory Enforcement`>0.82),
                   aes(label = name),
                   box.padding   = 0.35, 
                   point.padding = 0.5,
                   segment.color = 'grey50') +
  theme_classic() +
  ggtitle("Order and Security and Regulatory Enforcement - WJP")

```

#Between databases

8) Studying the relationship between the Overall Score of the WJP Rule of Law and The Economist's Democracy Index
```{r}

x <- base %>% 
  filter(!is.na(`WJP Rule of Law Index: Overall Score`), 
         !is.na(`Overall Score`), days_after_1pm == 30)

base %>% 
  select(name, iso_code, `WJP Rule of Law Index: Overall Score`, `Overall Score`, days_after_1pm) %>% 
  filter(days_after_1pm == 30) %>% 
  filter(!is.na(`WJP Rule of Law Index: Overall Score`), 
         !is.na(`Overall Score`)) %>% 
  ggplot(mapping = aes(x = `WJP Rule of Law Index: Overall Score`,
                       y = `Overall Score`)) +
  geom_point() +
  geom_smooth(method = lm, se = FALSE) +
  geom_label_repel(data = subset(x, `WJP Rule of Law Index: Overall Score`>0.8),
                   aes(label = name),
                   box.padding   = 0.35, 
                   point.padding = 0.5,
                   segment.color = 'grey50') +
  theme_clean() +
  labs(title = "WJP and Democracy Index: Overall Scores")

```


9) Studying the relationship between the 3.3 variable (Civil Participation) of WJP and The Economist's Democracy Index

```{r}
gen_names_2 <- base %>% 
  filter(!is.na(`3.3 Civic participation`), 
         !is.na(`Overall Score`), days_after_1pm == 30)

base %>% 
  select(name, iso_code, `3.3 Civic participation`, `Overall Score`, days_after_1pm) %>% 
  filter(days_after_1pm == 30) %>% 
  filter(!is.na(`3.3 Civic participation`), 
         !is.na(`Overall Score`)) %>% 
  ggplot(mapping = aes(x = `3.3 Civic participation`, y = `Overall Score`)) +
  geom_point() +
  geom_smooth(method = lm, se = FALSE) +
  geom_label_repel(data = subset(gen_names_2, `3.3 Civic participation`>0.838),
                   aes(label = name),
                   box.padding   = 0.35, 
                   point.padding = 0.5,
                   segment.color = 'grey50') +
  theme_clean() +
  labs(title = "Overall Score and Civic Participation")

rm(gen_names_2)
```

10) Studying the relationship between Factor 2 (Absence of Corruption) of WJP and The Economist's Democracy Index

```{r}
gen_names_3 <- base %>% 
  filter(!is.na(`Factor 2: Absence of Corruption`), 
         !is.na(`Overall Score`), days_after_1pm == 30)

base %>% 
  select(name, iso_code, `Factor 2: Absence of Corruption`, `Overall Score`, days_after_1pm) %>% 
  filter(days_after_1pm == 30) %>% 
  filter(!is.na(`Factor 2: Absence of Corruption`), 
         !is.na(`Overall Score`)) %>% 
  ggplot(mapping = aes(x = `Factor 2: Absence of Corruption`, y = `Overall Score`)) +
  geom_point() +
  geom_smooth(method = lm, se = FALSE) +
  geom_label_repel(data = subset(gen_names_3, `Factor 2: Absence of Corruption`>0.85),
                   aes(label = name),
                   box.padding   = 0.35, 
                   point.padding = 0.5,
                   segment.color = 'grey50') +
  theme_clean() +
  labs(title = "Overall Score and Absence of Corruption")

rm(gen_names_3)
```

11) Studying the relationship between the averages of Factor 6 e and the rates of death and total cases related to Covid-19 

```{r}
gen_names_4 <- base %>% 
  filter(!is.na(`Factor 6: Regulatory Enforcement`), !is.na(total_cases_per_million), 
         !is.na(total_deaths_per_million), days_after_1pm == 100)

# Using compatible information (days_after_1pm)
base %>% 
  select(name, iso_code, total_cases_per_million, `Factor 6: Regulatory Enforcement`, days_after_1pm) %>% 
  filter(days_after_1pm == 100) %>% 
  filter(!is.na(`Factor 6: Regulatory Enforcement`), 
         !is.na(total_cases_per_million)) %>% 
  ggplot(mapping = aes(y = log(total_cases_per_million), x = `Factor 6: Regulatory Enforcement`)) +
  geom_point() +
  geom_smooth(method = lm, se = FALSE) +
  geom_label_repel(data = subset(gen_names_4, total_cases_per_million>15000),
                   aes(label = name),
                   box.padding   = 0.35, 
                   point.padding = 0.5,
                   segment.color = 'grey50') +
  labs(title = "Regulatory enforcement and COVID-19 cases/million plot", 
       subtitle = ("Mid September")) +
  theme_clean()
       
rm(gen_names_4)
```

12) Studying the relationship between the averages of Factor 4 and 6, from the Oxford Response Tracker 


```{r}

base %>% 
  select(name, iso_code, `Factor 4: Fundamental Rights`, c6_stay_at_home_requirements, days_after_1pm) %>% 
  filter(!is.na(`Factor 4: Fundamental Rights`), 
         !is.na(c6_stay_at_home_requirements)) %>% 
  ggplot(mapping = aes(group = c6_stay_at_home_requirements, y = `Factor 4: Fundamental Rights`)) +
  geom_boxplot() +
  labs(title = "Fundamental Rights and Stay at home requirements", x = "Stay at home requirements") +
  theme_classic()

```

12B) Previous analysis, animated using a gif and the time variable "days_after_1pm"

```{r}

p11 <- base %>% 
  select(name, iso_code, `Factor 4: Fundamental Rights`, c6_stay_at_home_requirements, days_after_1pm) %>% 
  filter(!is.na(`Factor 4: Fundamental Rights`), 
         !is.na(c6_stay_at_home_requirements),!is.na(days_after_1pm), days_after_1pm < 251) %>% 
  ggplot(mapping = aes(x = c6_stay_at_home_requirements, y = `Factor 4: Fundamental Rights`)) +
  geom_point() +
  scale_alpha(guide = 'none') 
  geom_smooth(method = lm, se = FALSE) +
  theme_classic() +
  labs(x = "Stay at home requirements")

anim11 <- p11 + transition_time(days_after_1pm) +
  labs(title = "Days after 1 death per million: {frame_time}")

animate(anim11, renderer = gifski_renderer("gifregulatory.gif"))
```

13) Comparing the map with the average of Factor 6 and the map with Covid-19 data, controlling by population size

```{r}

mapcovid <- base %>% 
  select(name, iso_code, iso2, total_deaths_per_million, days_after_1pm) %>% 
  filter(!is.na(total_deaths_per_million), days_after_1pm == 200) %>%
  #filter(!is.na(`Factor 6: Regulatory Enforcement`), date == Sys.Date() - 1) %>%
  clean_names() %>%
  #left_join(iso) %>% 
  left_join(world, by = c("iso2" = "iso_a2")) %>% 
  ggplot() +
   geom_sf(aes(geometry = geom), data = world, fill = "lightgrey") +
   geom_sf(aes(geometry = geom, fill = total_deaths_per_million)) +
   scale_fill_gradient(high = "#ff726f", low = "#0087C0", limits = c(0, 1000), breaks = seq(0, 1000, 100)) +
   labs(title = "Total deaths per million",
        subtitle = ("Values for 200 days after country reached 1 case per million"),
        fill = "Index",
        caption = "Source: Our World In Data") +
   theme_map() +
    theme(panel.background = element_rect(fill = "#b3d5e0"),
            legend.position = "right") 

mapfactor6
mapcovid

```



#Additional Descriptive Analysis

1) Total cases per million x Gini Index

```{r}

#Calculating the quartiles

base %>% 
  filter(days_after_1pm == 1) %>% 
  summarize(qs = quantile(population, c(0.33, 0.66)), prob = c(0.33, 0.66))

#Graph
  
base %>% 
  filter(days_after_1pm == 100) %>% 
  mutate(pop_size = case_when(population < 2414713 ~ "Small", 
                              population > 2414713 & population < 15831401 ~ "Medium",
                              population > 15831401 ~ "Large")) %>% 
  ggplot(aes(gini_index_world_bank_estimate, total_cases_per_million)) +
  geom_point(aes(size = population, alpha = 0.5, color = region)) +
  facet_wrap(~ pop_size) +
  theme_clean() +
  labs(x = "Gini Index", 
       y = "Total cases per million", 
       title = "Inequality and Covid cases")

#Animation
  
gtc <- base %>% 
  select(name, population, region, days_after_1pm, gini_index_world_bank_estimate, total_cases_per_million) %>% 
  filter(days_after_1pm < 290) %>% 
  mutate(pop_size = case_when(population < 2414713 ~ "Small", 
                              population > 2414713 & population < 15831401 ~ "Medium",
                              population > 15831401 ~ "Large")) %>% 
  ggplot(aes(gini_index_world_bank_estimate, log(total_cases_per_million))) +
  geom_point(aes(size = population, alpha = 0.5, color = region)) +
  scale_alpha(guide = 'none') +
  geom_smooth(method = lm, se = FALSE) +
  facet_wrap(~ pop_size) +
  theme_clean() +
  labs(x = "Gini Index", 
       y = "Log (Total cases per million)",
       subtitle = "Divided by population size")

anim_gtc <- gtc + transition_time(days_after_1pm) +
  labs(title = "Days after 1 death per million: {frame_time}") +
  ease_aes('linear')

animate(anim_gtc, renderer = gifski_renderer("gifGTC.gif"))


```

2) Days Distribution

```{r}

base %>% 
  select(name, days_after_1pm, date) %>% 
  group_by(name)%>% 
  slice(which.max(days_after_1pm)) %>% 
  ungroup() %>% 
  mutate(name = fct_reorder(name, desc(days_after_1pm))) %>% 
  ggplot(aes(name, days_after_1pm)) +
  geom_col() +
  coord_flip() +
  theme_classic()

base %>% 
  select(name, days_after_1pm, date) %>% 
  group_by(name)%>% 
  slice(which.max(days_after_1pm)) %>% 
  ungroup() %>% 
  select(days_after_1pm) %>% 
  ggplot(aes(days_after_1pm)) +
  geom_histogram() +
  theme_classic()
```

3) Gini x Cases (WJP Groups)

```{r}
#Graph
  
base %>% 
  filter(days_after_1pm == 100, !is.na(`Income Group`)) %>% 
  clean_names() %>% 
  ggplot(aes(gini_index_world_bank_estimate, total_cases_per_million)) +
  geom_point(aes(size = 3, alpha = 0.5, color = region)) +
  scale_alpha(guide = 'none') +
  geom_smooth(method = lm, se = FALSE) +
  facet_wrap(~ income_group) +
  theme_clean() +
  labs(x = "Gini Index", 
       y = "Total cases per million", 
       title = "Inequality and Covid cases", 
       subtitle = "100 days after reaching 1 case per million")

#GIF

wrap <- base %>% 
  filter(!is.na(`Income Group`), !is.na(days_after_1pm)) %>% 
  clean_names() %>% 
  mutate(logTCPM = log(total_cases_per_million)) %>% 
  ggplot(aes(gini_index_world_bank_estimate, logTCPM)) +
  geom_point(aes(size = 3, alpha = 0.5, color = region)) +
  scale_alpha(guide = 'none') +
  geom_smooth(method = lm, se = FALSE) +
  facet_wrap(~ income_group) +
  theme_clean() +
  labs(x = "Gini Index", 
       y = "Total cases per million (log)", 
       title = "Inequality and Covid cases")

anim_wrap <- wrap + transition_time(days_after_1pm) +
  labs(subtitle = "Days after 1 death per million: {frame_time}") +
  ease_aes('linear')

animate(anim_wrap, renderer = gifski_renderer("gifwrap.gif"))


```


##Regressions and tests
```{r}

b <- base %>% 
  filter(days_after_1pm > 0) 

reg <- lm(total_cases_per_million ~ `Overall Score` +`WJP Rule of Law Index: Overall Score` + gini_index_world_bank_estimate + log(population) + log(gdp_per_capita) + aged_65_older + median_age + population_density + Region + `Income Group`, data = b)

summary(reg)

# regredir
## indice da democria ~ testes
## usar a regressão como algo para chamar atenção a relações
### binsreg

reg2 <- lm(total_cases_per_million ~ `Overall Score` +`WJP Rule of Law Index: Overall Score` + gini_index_world_bank_estimate + population + gdp_per_capita + aged_65_older + median_age + population_density + Region + `Income Group` + days_after_1pm + human_development_index, data = b)

summary(reg2)

reg3 <- lm(total_cases_per_million ~ `Overall Score` + gini_index_world_bank_estimate + population + gdp_per_capita + aged_65_older + median_age + population_density + Region + `Income Group` + days_after_1pm + human_development_index, data = b)

summary(reg3)

reg4 <- lm(total_cases_per_million ~ `WJP Rule of Law Index: Overall Score` + gini_index_world_bank_estimate + population + gdp_per_capita + aged_65_older + median_age + population_density + Region + `Income Group` + days_after_1pm + human_development_index, data = b)

summary(reg4)

# Regression Analysis with the last day of data from each country

b2 <- base %>% 
  filter(days_after_1pm > 0) %>% 
  group_by(name)%>% 
  slice(which.max(days_after_1pm)) %>% 
  ungroup() 

reg5 <- lm(total_cases_per_million ~ `Overall Score` + `WJP Rule of Law Index: Overall Score` + gini_index_world_bank_estimate + population + gdp_per_capita + aged_65_older + median_age + population_density + Region + `Income Group` + days_after_1pm + human_development_index, data = b2)

summary(reg5)
```

área de testes


```{r}



x <- binsreg(b$total_cases_per_million, b$gini_index_world_bank_estimate, w = b$population)

summary(x)

x2 <- binsreg(b$total_cases_per_million, b$`Overall Score`, w = b$gini_index_world_bank_estimate)

summary(x2)

x3 <- binsreg(b$`Overall Score`, b$`WJP Rule of Law Index: Overall Score`, w = c(b$gini_index_world_bank_estimate))

summary(x3)
```

